{"version":3,"file":"exceptions-handler.js","sourceRoot":"D:/04-learn-font/learn-node/nest/packages/core/","sources":["exceptions/exceptions-handler.ts"],"names":[],"mappings":";;;AAAA,oEAA4D;AAI5D,sHAA2G;AAC3G,mEAA8D;AAC9D,gHAA0G;AAE1G,MAAa,iBAAkB,SAAQ,2CAAmB;IAA1D;;QACU,YAAO,GAA8B,EAAE,CAAC;IA4BlD,CAAC;IA1BQ,IAAI,CAAC,SAAsC,EAAE,GAAkB;QACpE,IAAI,IAAI,CAAC,mBAAmB,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE;YAC5C,OAAO;SACR;QACD,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;IAC9B,CAAC;IAEM,gBAAgB,CAAC,OAAkC;QACxD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;YAC3B,MAAM,IAAI,oEAA+B,EAAE,CAAC;SAC7C;QACD,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,CAAC;IAEM,mBAAmB,CACxB,SAAY,EACZ,GAAkB;QAElB,IAAI,IAAA,sBAAO,EAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YACzB,OAAO,KAAK,CAAC;SACd;QAED,MAAM,MAAM,GAAG,IAAA,qEAA6B,EAAC,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;QACtE,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;QACtC,OAAO,CAAC,CAAC,MAAM,CAAC;IAClB,CAAC;CACF;AA7BD,8CA6BC","sourcesContent":["import { isEmpty } from '@nestjs/common/utils/shared.utils';\r\nimport { HttpException } from '@nestjs/common';\r\nimport { ArgumentsHost } from '@nestjs/common/interfaces/features/arguments-host.interface';\r\nimport { ExceptionFilterMetadata } from '@nestjs/common/interfaces/exceptions/exception-filter-metadata.interface';\r\nimport { selectExceptionFilterMetadata } from '@nestjs/common/utils/select-exception-filter-metadata.util';\r\nimport { BaseExceptionFilter } from './base-exception-filter';\r\nimport { InvalidExceptionFilterException } from '../errors/exceptions/invalid-exception-filter.exception';\r\n\r\nexport class ExceptionsHandler extends BaseExceptionFilter {\r\n  private filters: ExceptionFilterMetadata[] = [];\r\n\r\n  public next(exception: Error | HttpException | any, ctx: ArgumentsHost) {\r\n    if (this.invokeCustomFilters(exception, ctx)) {\r\n      return;\r\n    }\r\n    super.catch(exception, ctx);\r\n  }\r\n\r\n  public setCustomFilters(filters: ExceptionFilterMetadata[]) {\r\n    if (!Array.isArray(filters)) {\r\n      throw new InvalidExceptionFilterException();\r\n    }\r\n    this.filters = filters;\r\n  }\r\n\r\n  public invokeCustomFilters<T = any>(\r\n    exception: T,\r\n    ctx: ArgumentsHost,\r\n  ): boolean {\r\n    if (isEmpty(this.filters)) {\r\n      return false;\r\n    }\r\n\r\n    const filter = selectExceptionFilterMetadata(this.filters, exception);\r\n    filter && filter.func(exception, ctx);\r\n    return !!filter;\r\n  }\r\n}\r\n"]}