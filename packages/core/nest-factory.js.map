{"version":3,"file":"nest-factory.js","sourceRoot":"D:/04-learn-font/learn-node/nest/packages/core/","sources":["nest-factory.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  HttpServer,\r\n  INestApplication,\r\n  INestApplicationContext,\r\n  INestMicroservice,\r\n} from '@nestjs/common';\r\nimport { NestMicroserviceOptions } from '@nestjs/common/interfaces/microservices/nest-microservice-options.interface';\r\nimport { NestApplicationContextOptions } from '@nestjs/common/interfaces/nest-application-context-options.interface';\r\nimport { NestApplicationOptions } from '@nestjs/common/interfaces/nest-application-options.interface';\r\nimport { Logger } from '@nestjs/common/services/logger.service';\r\nimport { loadPackage } from '@nestjs/common/utils/load-package.util';\r\nimport { isFunction, isNil } from '@nestjs/common/utils/shared.utils';\r\nimport { AbstractHttpAdapter } from './adapters/http-adapter';\r\nimport { ApplicationConfig } from './application-config';\r\nimport { MESSAGES } from './constants';\r\nimport { ExceptionsZone } from './errors/exceptions-zone';\r\nimport { loadAdapter } from './helpers/load-adapter';\r\nimport { rethrow } from './helpers/rethrow';\r\nimport { NestContainer } from './injector/container';\r\nimport { Injector } from './injector/injector';\r\nimport { InstanceLoader } from './injector/instance-loader';\r\nimport { GraphInspector } from './inspector/graph-inspector';\r\nimport { NoopGraphInspector } from './inspector/noop-graph-inspector';\r\nimport { UuidFactory, UuidFactoryMode } from './inspector/uuid-factory';\r\nimport { MetadataScanner } from './metadata-scanner';\r\nimport { NestApplication } from './nest-application';\r\nimport { NestApplicationContext } from './nest-application-context';\r\nimport { DependenciesScanner } from './scanner';\r\n\r\n/**\r\n * @publicApi\r\n */\r\nexport class NestFactoryStatic {\r\n  private readonly logger = new Logger('NestFactory', {\r\n    timestamp: true,\r\n  });\r\n  private abortOnError = true;\r\n  private autoFlushLogs = false;\r\n\r\n  /**\r\n   * Creates an instance of NestApplication.\r\n   *\r\n   * @param module Entry (root) application module class\r\n   * @param options List of options to initialize NestApplication\r\n   *\r\n   * @returns A promise that, when resolved,\r\n   * contains a reference to the NestApplication instance.\r\n   */\r\n  public async create<T extends INestApplication = INestApplication>(\r\n    module: any,\r\n    options?: NestApplicationOptions,\r\n  ): Promise<T>;\r\n  /**\r\n   * Creates an instance of NestApplication with the specified `httpAdapter`.\r\n   *\r\n   * @param module Entry (root) application module class\r\n   * @param httpAdapter Adapter to proxy the request/response cycle to\r\n   *    the underlying HTTP server\r\n   * @param options List of options to initialize NestApplication\r\n   *\r\n   * @returns A promise that, when resolved,\r\n   * contains a reference to the NestApplication instance.\r\n   */\r\n  public async create<T extends INestApplication = INestApplication>(\r\n    module: any,\r\n    httpAdapter: AbstractHttpAdapter,\r\n    options?: NestApplicationOptions,\r\n  ): Promise<T>;\r\n  public async create<T extends INestApplication = INestApplication>(\r\n    moduleCls: any,\r\n    serverOrOptions?: AbstractHttpAdapter | NestApplicationOptions,\r\n    options?: NestApplicationOptions,\r\n  ): Promise<T> {\r\n    const [httpServer, appOptions] = this.isHttpServer(serverOrOptions)\r\n      ? [serverOrOptions, options]\r\n      : [this.createHttpAdapter(), serverOrOptions];\r\n\r\n    const applicationConfig = new ApplicationConfig();\r\n    const container = new NestContainer(applicationConfig);\r\n    const graphInspector = this.createGraphInspector(appOptions, container);\r\n\r\n    this.setAbortOnError(serverOrOptions, options);\r\n    this.registerLoggerConfiguration(appOptions);\r\n\r\n    await this.initialize(\r\n      moduleCls,\r\n      container,\r\n      graphInspector,\r\n      applicationConfig,\r\n      appOptions,\r\n      httpServer,\r\n    );\r\n\r\n    const instance = new NestApplication(\r\n      container,\r\n      httpServer,\r\n      applicationConfig,\r\n      graphInspector,\r\n      appOptions,\r\n    );\r\n    const target = this.createNestInstance(instance);\r\n    return this.createAdapterProxy<T>(target, httpServer);\r\n  }\r\n\r\n  /**\r\n   * Creates an instance of NestMicroservice.\r\n   *\r\n   * @param moduleCls Entry (root) application module class\r\n   * @param options Optional microservice configuration\r\n   *\r\n   * @returns A promise that, when resolved,\r\n   * contains a reference to the NestMicroservice instance.\r\n   */\r\n  public async createMicroservice<T extends object>(\r\n    moduleCls: any,\r\n    options?: NestMicroserviceOptions & T,\r\n  ): Promise<INestMicroservice> {\r\n    const { NestMicroservice } = loadPackage(\r\n      '@nestjs/microservices',\r\n      'NestFactory',\r\n      () => require('@nestjs/microservices'),\r\n    );\r\n    const applicationConfig = new ApplicationConfig();\r\n    const container = new NestContainer(applicationConfig);\r\n    const graphInspector = this.createGraphInspector(options, container);\r\n\r\n    this.setAbortOnError(options);\r\n    this.registerLoggerConfiguration(options);\r\n\r\n    await this.initialize(\r\n      moduleCls,\r\n      container,\r\n      graphInspector,\r\n      applicationConfig,\r\n      options,\r\n    );\r\n    return this.createNestInstance<INestMicroservice>(\r\n      new NestMicroservice(\r\n        container,\r\n        options,\r\n        graphInspector,\r\n        applicationConfig,\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Creates an instance of NestApplicationContext.\r\n   *\r\n   * @param moduleCls Entry (root) application module class\r\n   * @param options Optional Nest application configuration\r\n   *\r\n   * @returns A promise that, when resolved,\r\n   * contains a reference to the NestApplicationContext instance.\r\n   */\r\n  public async createApplicationContext(\r\n    moduleCls: any,\r\n    options?: NestApplicationContextOptions,\r\n  ): Promise<INestApplicationContext> {\r\n    const applicationConfig = new ApplicationConfig();\r\n    const container = new NestContainer(applicationConfig);\r\n    const graphInspector = this.createGraphInspector(options, container);\r\n\r\n    this.setAbortOnError(options);\r\n    this.registerLoggerConfiguration(options);\r\n\r\n    await this.initialize(\r\n      moduleCls,\r\n      container,\r\n      graphInspector,\r\n      applicationConfig,\r\n      options,\r\n    );\r\n\r\n    const modules = container.getModules().values();\r\n    const root = modules.next().value;\r\n\r\n    const context = this.createNestInstance<NestApplicationContext>(\r\n      new NestApplicationContext(container, options, root),\r\n    );\r\n    if (this.autoFlushLogs) {\r\n      context.flushLogsOnOverride();\r\n    }\r\n    return context.init();\r\n  }\r\n\r\n  private createNestInstance<T>(instance: T): T {\r\n    return this.createProxy(instance);\r\n  }\r\n\r\n  private async initialize(\r\n    module: any,\r\n    container: NestContainer,\r\n    graphInspector: GraphInspector,\r\n    config = new ApplicationConfig(),\r\n    options: NestApplicationContextOptions = {},\r\n    httpServer: HttpServer = null,\r\n  ) {\r\n    UuidFactory.mode = options.snapshot\r\n      ? UuidFactoryMode.Deterministic\r\n      : UuidFactoryMode.Random;\r\n\r\n    const injector = new Injector({ preview: options.preview });\r\n    const instanceLoader = new InstanceLoader(\r\n      container,\r\n      injector,\r\n      graphInspector,\r\n    );\r\n    const metadataScanner = new MetadataScanner();\r\n    const dependenciesScanner = new DependenciesScanner(\r\n      container,\r\n      metadataScanner,\r\n      graphInspector,\r\n      config,\r\n    );\r\n    container.setHttpAdapter(httpServer);\r\n\r\n    const teardown = this.abortOnError === false ? rethrow : undefined;\r\n    await httpServer?.init();\r\n    try {\r\n      this.logger.log(MESSAGES.APPLICATION_START);\r\n\r\n      await ExceptionsZone.asyncRun(\r\n        async () => {\r\n          await dependenciesScanner.scan(module);\r\n          await instanceLoader.createInstancesOfDependencies();\r\n          dependenciesScanner.applyApplicationProviders();\r\n        },\r\n        teardown,\r\n        this.autoFlushLogs,\r\n      );\r\n    } catch (e) {\r\n      this.handleInitializationError(e);\r\n    }\r\n  }\r\n\r\n  private handleInitializationError(err: unknown) {\r\n    if (this.abortOnError) {\r\n      process.abort();\r\n    }\r\n    rethrow(err);\r\n  }\r\n\r\n  private createProxy(target: any) {\r\n    const proxy = this.createExceptionProxy();\r\n    return new Proxy(target, {\r\n      get: proxy,\r\n      set: proxy,\r\n    });\r\n  }\r\n\r\n  private createExceptionProxy() {\r\n    return (receiver: Record<string, any>, prop: string) => {\r\n      if (!(prop in receiver)) {\r\n        return;\r\n      }\r\n      if (isFunction(receiver[prop])) {\r\n        return this.createExceptionZone(receiver, prop);\r\n      }\r\n      return receiver[prop];\r\n    };\r\n  }\r\n\r\n  private createExceptionZone(\r\n    receiver: Record<string, any>,\r\n    prop: string,\r\n  ): Function {\r\n    const teardown = this.abortOnError === false ? rethrow : undefined;\r\n\r\n    return (...args: unknown[]) => {\r\n      let result: unknown;\r\n      ExceptionsZone.run(() => {\r\n        result = receiver[prop](...args);\r\n      }, teardown);\r\n\r\n      return result;\r\n    };\r\n  }\r\n\r\n  private registerLoggerConfiguration(\r\n    options: NestApplicationContextOptions | undefined,\r\n  ) {\r\n    if (!options) {\r\n      return;\r\n    }\r\n    const { logger, bufferLogs, autoFlushLogs } = options;\r\n    if ((logger as boolean) !== true && !isNil(logger)) {\r\n      Logger.overrideLogger(logger);\r\n    }\r\n    if (bufferLogs) {\r\n      Logger.attachBuffer();\r\n    }\r\n    this.autoFlushLogs = autoFlushLogs ?? true;\r\n  }\r\n\r\n  private createHttpAdapter<T = any>(httpServer?: T): AbstractHttpAdapter {\r\n    const { ExpressAdapter } = loadAdapter(\r\n      '@nestjs/platform-express',\r\n      'HTTP',\r\n      () => require('@nestjs/platform-express'),\r\n    );\r\n    return new ExpressAdapter(httpServer);\r\n  }\r\n\r\n  private isHttpServer(\r\n    serverOrOptions: AbstractHttpAdapter | NestApplicationOptions,\r\n  ): serverOrOptions is AbstractHttpAdapter {\r\n    return !!(\r\n      serverOrOptions && (serverOrOptions as AbstractHttpAdapter).patch\r\n    );\r\n  }\r\n\r\n  private setAbortOnError(\r\n    serverOrOptions?: AbstractHttpAdapter | NestApplicationOptions,\r\n    options?: NestApplicationContextOptions | NestApplicationOptions,\r\n  ) {\r\n    this.abortOnError = this.isHttpServer(serverOrOptions)\r\n      ? !(options && options.abortOnError === false)\r\n      : !(serverOrOptions && serverOrOptions.abortOnError === false);\r\n  }\r\n\r\n  private createAdapterProxy<T>(app: NestApplication, adapter: HttpServer): T {\r\n    const proxy = new Proxy(app, {\r\n      get: (receiver: Record<string, any>, prop: string) => {\r\n        const mapToProxy = (result: unknown) => {\r\n          return result instanceof Promise\r\n            ? result.then(mapToProxy)\r\n            : result instanceof NestApplication\r\n            ? proxy\r\n            : result;\r\n        };\r\n\r\n        if (!(prop in receiver) && prop in adapter) {\r\n          return (...args: unknown[]) => {\r\n            const result = this.createExceptionZone(adapter, prop)(...args);\r\n            return mapToProxy(result);\r\n          };\r\n        }\r\n        if (isFunction(receiver[prop])) {\r\n          return (...args: unknown[]) => {\r\n            const result = receiver[prop](...args);\r\n            return mapToProxy(result);\r\n          };\r\n        }\r\n        return receiver[prop];\r\n      },\r\n    });\r\n    return proxy as unknown as T;\r\n  }\r\n\r\n  private createGraphInspector(\r\n    appOptions: NestApplicationContextOptions,\r\n    container: NestContainer,\r\n  ) {\r\n    return appOptions?.snapshot\r\n      ? new GraphInspector(container)\r\n      : NoopGraphInspector;\r\n  }\r\n}\r\n\r\n/**\r\n * Use NestFactory to create an application instance.\r\n *\r\n * ### Specifying an entry module\r\n *\r\n * Pass the required *root module* for the application via the module parameter.\r\n * By convention, it is usually called `ApplicationModule`.  Starting with this\r\n * module, Nest assembles the dependency graph and begins the process of\r\n * Dependency Injection and instantiates the classes needed to launch your\r\n * application.\r\n *\r\n * @publicApi\r\n */\r\nexport const NestFactory = new NestFactoryStatic();\r\n"]}