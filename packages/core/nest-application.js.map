{"version":3,"file":"nest-application.js","sourceRoot":"D:/04-learn-font/learn-node/nest/packages/core/","sources":["nest-application.ts"],"names":[],"mappings":";;;AAAA,2CAYwB;AASxB,2EAAgE;AAChE,8EAAqE;AACrE,oEAK2C;AAC3C,qCAAkC;AAClC,2BAA8B;AAE9B,6DAAyD;AACzD,2CAAuC;AACvC,iEAA6D;AAE7D,kDAA+C;AAE/C,sDAA6D;AAC7D,sEAAkE;AAClE,8CAAuD;AACvD,yEAAoE;AAEpE,8DAA0D;AAE1D,MAAM,EAAE,YAAY,EAAE,GAAG,IAAA,kCAAe,EACtC,kCAAkC,EAClC,GAAG,EAAE,CAAC,OAAO,CAAC,kCAAkC,CAAC,CAClD,CAAC;AACF,MAAM,EAAE,mBAAmB,EAAE,GAAG,IAAA,kCAAe,EAC7C,4CAA4C,EAC5C,GAAG,EAAE,CAAC,OAAO,CAAC,4CAA4C,CAAC,CAC5D,CAAC;AAEF;;GAEG;AACH,MAAa,eACX,SAAQ,iDAA8C;IAkBtD,YACE,SAAwB,EACP,WAAuB,EACvB,MAAyB,EACzB,cAA8B,EAC/C,aAAqC,EAAE;QAEvC,KAAK,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;QALZ,gBAAW,GAAX,WAAW,CAAY;QACvB,WAAM,GAAN,MAAM,CAAmB;QACzB,mBAAc,GAAd,cAAc,CAAgB;QAnB9B,WAAM,GAAG,IAAI,uBAAM,CAAC,eAAe,CAAC,IAAI,EAAE;YAC3D,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEc,wBAAmB,GAAG,IAAI,+BAAmB,CAC5D,IAAI,CAAC,SAAS,CACf,CAAC;QACe,wBAAmB,GAClC,mBAAmB,IAAI,IAAI,mBAAmB,EAAE,CAAC;QAClC,iBAAY,GAAG,YAAY,IAAI,IAAI,YAAY,EAAE,CAAC;QAElD,kBAAa,GAAU,EAAE,CAAC;QAEnC,gBAAW,GAAG,KAAK,CAAC;QAW1B,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC1B,IAAI,CAAC,QAAQ,GAAG,IAAI,mBAAQ,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;QACnE,IAAI,CAAC,gBAAgB,GAAG,IAAI,oCAAgB,EAAE,CAAC;QAC/C,IAAI,CAAC,cAAc,GAAG,IAAI,gCAAc,CACtC,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,cAAc,CACpB,CAAC;IACJ,CAAC;IAES,KAAK,CAAC,OAAO;QACrB,IAAI,CAAC,YAAY,IAAI,CAAC,MAAM,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC,CAAC;QACvD,IAAI,CAAC,mBAAmB,IAAI,CAAC,MAAM,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC,CAAC;QACrE,IAAI,CAAC,WAAW,IAAI,CAAC,MAAM,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,CAAC;QAErD,MAAM,OAAO,CAAC,GAAG,CACf,IAAA,iBAAO,EAAC,IAAI,CAAC,aAAa,CAAC,CAAC,GAAG,CAAC,KAAK,EAAC,YAAY,EAAC,EAAE;YACnD,YAAY,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YACnC,MAAM,YAAY,CAAC,KAAK,EAAE,CAAC;QAC7B,CAAC,CAAC,CACH,CAAC;IACJ,CAAC;IAEM,cAAc;QACnB,OAAO,IAAI,CAAC,WAAkC,CAAC;IACjD,CAAC;IAEM,kBAAkB;QACvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;IACxC,CAAC;IAEM,uBAAuB;QAC5B,OAAO,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;IAC1C,CAAC;IAEM,YAAY;QACjB,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE;YAC7C,OAAO,SAAS,CAAC;SAClB;QACD,MAAM,iBAAiB,GACrB,IAAA,uBAAQ,EAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,IAAA,yBAAU,EAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACrE,IAAI,CAAC,iBAAiB,EAAE;YACtB,OAAO,IAAI,CAAC,UAAU,EAAE,CAAC;SAC1B;QACD,OAAO,IAAI,CAAC,UAAU,CACpB,IAAI,CAAC,UAAU,CAAC,IAA8C,CAC/D,CAAC;IACJ,CAAC;IAEM,YAAY;QACjB,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACjD,OAAO,IAAI,CAAC,WAAW,CAAC,aAAa,EAAO,CAAC;IAC/C,CAAC;IAEM,KAAK,CAAC,eAAe;QAC1B,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAExB,IAAI,IAAI,CAAC,mBAAmB,EAAE;YAC5B,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAC/B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,UAAU,CAChB,CAAC;YACF,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SACvD;QAED,MAAM,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAClC,IAAI,CAAC,mBAAmB,EACxB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,UAAU,CAChB,CAAC;IACJ,CAAC;IAEM,gBAAgB;QACrB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,YAAY,CAAC,QAAQ,CACxB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,UAAU,EACf,IAAI,CAAC,UAAU,CAChB,CAAC;IACJ,CAAC;IAEM,KAAK,CAAC,IAAI;QACf,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,MAAM,IAAI,CAAC,WAAW,EAAE,IAAI,EAAE,CAAC;QAE/B,MAAM,aAAa,GACjB,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,UAAU,KAAK,KAAK,CAAC;QAC1D,aAAa,IAAI,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAEjD,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;QAC7B,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;QAC5B,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;QAC1B,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;QACjC,MAAM,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAE/B,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAQ,CAAC,iBAAiB,CAAC,CAAC;QAC5C,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,wBAAwB;QAC7B,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE,CAAC;QAC7C,MAAM,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,CAAC;QAC3C,IAAI,CAAC,WAAW,CAAC,wBAAwB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IAC7D,CAAC;IAEM,KAAK,CAAC,cAAc;QACzB,MAAM,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAEhD,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE,CAAC;QAC7C,MAAM,QAAQ,GAAG,IAAA,8BAAe,EAAC,MAAM,CAAC,CAAC;QACzC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;IAC1D,CAAC;IAEM,KAAK,CAAC,mBAAmB;QAC9B,IAAI,CAAC,cAAc,CAAC,uBAAuB,EAAE,CAAC;QAC9C,IAAI,CAAC,cAAc,CAAC,wBAAwB,EAAE,CAAC;IACjD,CAAC;IAEM,mBAAmB,CACxB,mBAAsB,EACtB,mBAAiD,EAAE;QAEnD,MAAM,EAAE,gBAAgB,EAAE,GAAG,IAAA,+BAAW,EACtC,uBAAuB,EACvB,aAAa,EACb,GAAG,EAAE,CAAC,OAAO,CAAC,uBAAuB,CAAC,CACvC,CAAC;QACF,MAAM,EAAE,gBAAgB,EAAE,GAAG,gBAAgB,CAAC;QAC9C,MAAM,iBAAiB,GAAG,gBAAgB;YACxC,CAAC,CAAC,IAAI,CAAC,MAAM;YACb,CAAC,CAAC,IAAI,sCAAiB,EAAE,CAAC;QAE5B,MAAM,QAAQ,GAAG,IAAI,gBAAgB,CACnC,IAAI,CAAC,SAAS,EACd,mBAAmB,EACnB,IAAI,CAAC,cAAc,EACnB,iBAAiB,CAClB,CAAC;QACF,QAAQ,CAAC,iBAAiB,EAAE,CAAC;QAC7B,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAChC,QAAQ,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QAEnC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAClC,OAAO,QAAQ,CAAC;IAClB,CAAC;IAEM,gBAAgB;QACrB,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAEM,aAAa;QAClB,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAEM,KAAK,CAAC,qBAAqB;QAChC,IAAI,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,CAAC;QACrD,MAAM,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QACjE,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,GAAG,CAAC,GAAG,IAAiB;QAC7B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC;QAC9B,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,aAAa,CAAC,GAAG,IAAiB;QACvC,IAAI,CAAC,CAAC,eAAe,IAAI,IAAI,CAAC,WAAW,CAAC,EAAE;YAC1C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,sDAAsD,CAAC,CAAC;YACzE,OAAO,IAAI,CAAC;SACb;QAED,MAAM,CAAC,UAAU,EAAE,GAAG,SAAS,CAAC,GAAG,IAAI,CAAC;QACxC,MAAM,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;QAE1C,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,GAAG,CAAC,UAAU,EAAE,OAAO,EAAE,GAAG,SAAS,CAAC,CAAC,CAAC;QAEvE,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,UAAU,CAAC,OAAgD;QAChE,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;IACvC,CAAC;IAEM,gBAAgB,CACrB,UAA6B,EAAE,IAAI,EAAE,uBAAc,CAAC,GAAG,EAAE;QAEzD,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC;IACd,CAAC;IAIM,KAAK,CAAC,MAAM,CAAC,IAAqB,EAAE,GAAG,IAAW;QACvD,IAAI,CAAC,sBAAsB,CAAC,QAAQ,CAAC,CAAC;QACtC,CAAC,IAAI,CAAC,aAAa,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;QAE3C,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACrC,MAAM,YAAY,GAAG,CAAC,CAAM,EAAE,EAAE;gBAC9B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,QAAQ,EAAE,EAAE,CAAC,CAAC;gBACnC,MAAM,CAAC,CAAC,CAAC,CAAC;YACZ,CAAC,CAAC;YACF,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YAE5C,MAAM,wBAAwB,GAAG,IAAA,yBAAU,EAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YACnE,MAAM,YAAY,GAAG,wBAAwB;gBAC3C,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;gBAChC,CAAC,CAAC,IAAI,CAAC;YAET,IAAI,CAAC,WAAW,CAAC,MAAM,CACrB,IAAI,EACJ,GAAG,YAAY,EACf,CAAC,GAAG,oBAA+B,EAAE,EAAE;gBACrC,IAAI,IAAI,CAAC,UAAU,EAAE,aAAa,IAAI,IAAI,EAAE;oBAC1C,IAAI,CAAC,SAAS,EAAE,CAAC;iBAClB;gBACD,IAAI,oBAAoB,CAAC,CAAC,CAAC,YAAY,KAAK,EAAE;oBAC5C,OAAO,MAAM,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;iBACxC;gBAED,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;gBAC1C,IAAI,OAAO,EAAE;oBACX,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;oBACtD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;oBACxB,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;iBAC1B;gBACD,IAAI,wBAAwB,EAAE;oBAC5B,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,oBAAoB,CAAC,CAAC;iBAChD;YACH,CAAC,CACF,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,KAAK,CAAC,MAAM;QACjB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACrC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACrB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,oBAAQ,CAAC,iBAAiB,CAAC,CAAC;gBAC9C,MAAM,CAAC,oBAAQ,CAAC,iBAAiB,CAAC,CAAC;gBACnC,OAAO;aACR;YACD,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;YAC1C,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,aAAa,CAAC,OAAY;QAChC,IAAI,IAAA,uBAAQ,EAAC,OAAO,CAAC,EAAE;YACrB,IAAI,IAAA,aAAQ,GAAE,KAAK,OAAO,EAAE;gBAC1B,OAAO,OAAO,CAAC;aAChB;YACD,MAAM,QAAQ,GAAG,kBAAkB,CAAC,OAAO,CAAC,CAAC;YAC7C,OAAO,GAAG,IAAI,CAAC,WAAW,EAAE,WAAW,QAAQ,EAAE,CAAC;SACnD;QAED,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;QACvB,IAAI,OAAO,IAAI,OAAO,CAAC,MAAM,KAAK,MAAM,EAAE;YACxC,IAAI,IAAI,KAAK,IAAI,EAAE;gBACjB,IAAI,GAAG,OAAO,CAAC;aAChB;iBAAM;gBACL,IAAI,GAAG,IAAI,IAAI,GAAG,CAAC;aACpB;SACF;aAAM,IAAI,IAAI,KAAK,SAAS,EAAE;YAC7B,IAAI,GAAG,WAAW,CAAC;SACpB;QAED,OAAO,GAAG,IAAI,CAAC,WAAW,EAAE,MAAM,IAAI,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC;IAC3D,CAAC;IAEM,eAAe,CAAC,MAAc,EAAE,OAA6B;QAClE,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;QACpC,IAAI,OAAO,EAAE;YACX,MAAM,OAAO,GAAG,OAAO,EAAE,OAAO;gBAC9B,CAAC,CAAC,IAAA,yBAAiB,EAAC,OAAO,CAAC,OAAO,CAAC;gBACpC,CAAC,CAAC,EAAE,CAAC;YACP,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC;gBACjC,GAAG,OAAO;gBACV,OAAO;aACR,CAAC,CAAC;SACJ;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,mBAAmB,CAAC,OAAyB;QAClD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,gBAAgB,CAAC,GAAG,OAA0B;QACnD,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,GAAG,OAAO,CAAC,CAAC;QACzC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CACrB,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC;YACzC,OAAO,EAAE,QAAQ;YACjB,GAAG,EAAE,IAAI;SACV,CAAC,CACH,CAAC;QACF,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,cAAc,CAAC,GAAG,KAA2B;QAClD,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,KAAK,CAAC,CAAC;QACrC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CACnB,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC;YACzC,OAAO,EAAE,MAAM;YACf,GAAG,EAAE,IAAI;SACV,CAAC,CACH,CAAC;QACF,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,qBAAqB,CAAC,GAAG,YAA+B;QAC7D,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC,GAAG,YAAY,CAAC,CAAC;QACnD,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAC1B,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC;YACzC,OAAO,EAAE,aAAa;YACtB,GAAG,EAAE,IAAI;SACV,CAAC,CACH,CAAC;QACF,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,eAAe,CAAC,GAAG,MAAqB;QAC7C,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,GAAG,MAAM,CAAC,CAAC;QACvC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CACpB,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC;YACzC,OAAO,EAAE,OAAO;YAChB,GAAG,EAAE,IAAI;SACV,CAAC,CACH,CAAC;QACF,OAAO,IAAI,CAAC;IACd,CAAC;IAIM,eAAe,CAAC,aAAkB,EAAE,OAAa;QACtD,IAAI,CAAC,WAAW,CAAC,eAAe;YAC9B,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;QAC3D,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,eAAe,CAAC,IAAuB;QAC5C,IAAI,CAAC,WAAW,CAAC,eAAe,IAAI,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QAC3E,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,aAAa,CAAC,eAAoB;QACvC,IAAI,CAAC,WAAW,CAAC,aAAa;YAC5B,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;QAClD,OAAO,IAAI,CAAC;IACd,CAAC;IACO,IAAI;QACV,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;QAC1C,IAAI,IAAA,uBAAQ,EAAC,OAAO,CAAC,EAAE;YACrB,OAAO,SAAS,CAAC;SAClB;QACD,OAAO,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC;IACpC,CAAC;IAEO,WAAW;QACjB,OAAO,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC;IAC5E,CAAC;IAEO,KAAK,CAAC,kBAAkB,CAAC,QAAa;QAC5C,MAAM,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,CAC5C,IAAI,CAAC,mBAAmB,EACxB,QAAQ,CACT,CAAC;IACJ,CAAC;CACF;AA5ZD,0CA4ZC","sourcesContent":["import {\r\n  CanActivate,\r\n  ExceptionFilter,\r\n  HttpServer,\r\n  INestApplication,\r\n  INestMicroservice,\r\n  NestHybridApplicationOptions,\r\n  NestInterceptor,\r\n  PipeTransform,\r\n  VersioningOptions,\r\n  VersioningType,\r\n  WebSocketAdapter,\r\n} from '@nestjs/common';\r\nimport {\r\n  GlobalPrefixOptions,\r\n  NestApplicationOptions,\r\n} from '@nestjs/common/interfaces';\r\nimport {\r\n  CorsOptions,\r\n  CorsOptionsDelegate,\r\n} from '@nestjs/common/interfaces/external/cors-options.interface';\r\nimport { Logger } from '@nestjs/common/services/logger.service';\r\nimport { loadPackage } from '@nestjs/common/utils/load-package.util';\r\nimport {\r\n  addLeadingSlash,\r\n  isFunction,\r\n  isObject,\r\n  isString,\r\n} from '@nestjs/common/utils/shared.utils';\r\nimport { iterate } from 'iterare';\r\nimport { platform } from 'os';\r\nimport { AbstractHttpAdapter } from './adapters';\r\nimport { ApplicationConfig } from './application-config';\r\nimport { MESSAGES } from './constants';\r\nimport { optionalRequire } from './helpers/optional-require';\r\nimport { NestContainer } from './injector/container';\r\nimport { Injector } from './injector/injector';\r\nimport { GraphInspector } from './inspector/graph-inspector';\r\nimport { MiddlewareContainer } from './middleware/container';\r\nimport { MiddlewareModule } from './middleware/middleware-module';\r\nimport { mapToExcludeRoute } from './middleware/utils';\r\nimport { NestApplicationContext } from './nest-application-context';\r\nimport { Resolver } from './router/interfaces/resolver.interface';\r\nimport { RoutesResolver } from './router/routes-resolver';\r\n\r\nconst { SocketModule } = optionalRequire(\r\n  '@nestjs/websockets/socket-module',\r\n  () => require('@nestjs/websockets/socket-module'),\r\n);\r\nconst { MicroservicesModule } = optionalRequire(\r\n  '@nestjs/microservices/microservices-module',\r\n  () => require('@nestjs/microservices/microservices-module'),\r\n);\r\n\r\n/**\r\n * @publicApi\r\n */\r\nexport class NestApplication\r\n  extends NestApplicationContext<NestApplicationOptions>\r\n  implements INestApplication\r\n{\r\n  protected readonly logger = new Logger(NestApplication.name, {\r\n    timestamp: true,\r\n  });\r\n  private readonly middlewareModule: MiddlewareModule;\r\n  private readonly middlewareContainer = new MiddlewareContainer(\r\n    this.container,\r\n  );\r\n  private readonly microservicesModule =\r\n    MicroservicesModule && new MicroservicesModule();\r\n  private readonly socketModule = SocketModule && new SocketModule();\r\n  private readonly routesResolver: Resolver;\r\n  private readonly microservices: any[] = [];\r\n  private httpServer: any;\r\n  private isListening = false;\r\n\r\n  constructor(\r\n    container: NestContainer,\r\n    private readonly httpAdapter: HttpServer,\r\n    private readonly config: ApplicationConfig,\r\n    private readonly graphInspector: GraphInspector,\r\n    appOptions: NestApplicationOptions = {},\r\n  ) {\r\n    super(container, appOptions);\r\n\r\n    this.selectContextModule();\r\n    this.registerHttpServer();\r\n    this.injector = new Injector({ preview: this.appOptions.preview });\r\n    this.middlewareModule = new MiddlewareModule();\r\n    this.routesResolver = new RoutesResolver(\r\n      this.container,\r\n      this.config,\r\n      this.injector,\r\n      this.graphInspector,\r\n    );\r\n  }\r\n\r\n  protected async dispose(): Promise<void> {\r\n    this.socketModule && (await this.socketModule.close());\r\n    this.microservicesModule && (await this.microservicesModule.close());\r\n    this.httpAdapter && (await this.httpAdapter.close());\r\n\r\n    await Promise.all(\r\n      iterate(this.microservices).map(async microservice => {\r\n        microservice.setIsTerminated(true);\r\n        await microservice.close();\r\n      }),\r\n    );\r\n  }\r\n\r\n  public getHttpAdapter(): AbstractHttpAdapter {\r\n    return this.httpAdapter as AbstractHttpAdapter;\r\n  }\r\n\r\n  public registerHttpServer() {\r\n    this.httpServer = this.createServer();\r\n  }\r\n\r\n  public getUnderlyingHttpServer<T>(): T {\r\n    return this.httpAdapter.getHttpServer();\r\n  }\r\n\r\n  public applyOptions() {\r\n    if (!this.appOptions || !this.appOptions.cors) {\r\n      return undefined;\r\n    }\r\n    const passCustomOptions =\r\n      isObject(this.appOptions.cors) || isFunction(this.appOptions.cors);\r\n    if (!passCustomOptions) {\r\n      return this.enableCors();\r\n    }\r\n    return this.enableCors(\r\n      this.appOptions.cors as CorsOptions | CorsOptionsDelegate<any>,\r\n    );\r\n  }\r\n\r\n  public createServer<T = any>(): T {\r\n    this.httpAdapter.initHttpServer(this.appOptions);\r\n    return this.httpAdapter.getHttpServer() as T;\r\n  }\r\n\r\n  public async registerModules() {\r\n    this.registerWsModule();\r\n\r\n    if (this.microservicesModule) {\r\n      this.microservicesModule.register(\r\n        this.container,\r\n        this.graphInspector,\r\n        this.config,\r\n        this.appOptions,\r\n      );\r\n      this.microservicesModule.setupClients(this.container);\r\n    }\r\n\r\n    await this.middlewareModule.register(\r\n      this.middlewareContainer,\r\n      this.container,\r\n      this.config,\r\n      this.injector,\r\n      this.httpAdapter,\r\n      this.graphInspector,\r\n      this.appOptions,\r\n    );\r\n  }\r\n\r\n  public registerWsModule() {\r\n    if (!this.socketModule) {\r\n      return;\r\n    }\r\n    this.socketModule.register(\r\n      this.container,\r\n      this.config,\r\n      this.graphInspector,\r\n      this.appOptions,\r\n      this.httpServer,\r\n    );\r\n  }\r\n\r\n  public async init(): Promise<this> {\r\n    if (this.isInitialized) {\r\n      return this;\r\n    }\r\n\r\n    this.applyOptions();\r\n    await this.httpAdapter?.init();\r\n\r\n    const useBodyParser =\r\n      this.appOptions && this.appOptions.bodyParser !== false;\r\n    useBodyParser && this.registerParserMiddleware();\r\n\r\n    await this.registerModules();\r\n    await this.registerRouter();\r\n    await this.callInitHook();\r\n    await this.registerRouterHooks();\r\n    await this.callBootstrapHook();\r\n\r\n    this.isInitialized = true;\r\n    this.logger.log(MESSAGES.APPLICATION_READY);\r\n    return this;\r\n  }\r\n\r\n  public registerParserMiddleware() {\r\n    const prefix = this.config.getGlobalPrefix();\r\n    const rawBody = !!this.appOptions?.rawBody;\r\n    this.httpAdapter.registerParserMiddleware(prefix, rawBody);\r\n  }\r\n\r\n  public async registerRouter() {\r\n    await this.registerMiddleware(this.httpAdapter);\r\n\r\n    const prefix = this.config.getGlobalPrefix();\r\n    const basePath = addLeadingSlash(prefix);\r\n    this.routesResolver.resolve(this.httpAdapter, basePath);\r\n  }\r\n\r\n  public async registerRouterHooks() {\r\n    this.routesResolver.registerNotFoundHandler();\r\n    this.routesResolver.registerExceptionHandler();\r\n  }\r\n\r\n  public connectMicroservice<T extends object>(\r\n    microserviceOptions: T,\r\n    hybridAppOptions: NestHybridApplicationOptions = {},\r\n  ): INestMicroservice {\r\n    const { NestMicroservice } = loadPackage(\r\n      '@nestjs/microservices',\r\n      'NestFactory',\r\n      () => require('@nestjs/microservices'),\r\n    );\r\n    const { inheritAppConfig } = hybridAppOptions;\r\n    const applicationConfig = inheritAppConfig\r\n      ? this.config\r\n      : new ApplicationConfig();\r\n\r\n    const instance = new NestMicroservice(\r\n      this.container,\r\n      microserviceOptions,\r\n      this.graphInspector,\r\n      applicationConfig,\r\n    );\r\n    instance.registerListeners();\r\n    instance.setIsInitialized(true);\r\n    instance.setIsInitHookCalled(true);\r\n\r\n    this.microservices.push(instance);\r\n    return instance;\r\n  }\r\n\r\n  public getMicroservices(): INestMicroservice[] {\r\n    return this.microservices;\r\n  }\r\n\r\n  public getHttpServer() {\r\n    return this.httpServer;\r\n  }\r\n\r\n  public async startAllMicroservices(): Promise<this> {\r\n    this.assertNotInPreviewMode('startAllMicroservices');\r\n    await Promise.all(this.microservices.map(msvc => msvc.listen()));\r\n    return this;\r\n  }\r\n\r\n  public use(...args: [any, any?]): this {\r\n    this.httpAdapter.use(...args);\r\n    return this;\r\n  }\r\n\r\n  public useBodyParser(...args: [any, any?]): this {\r\n    if (!('useBodyParser' in this.httpAdapter)) {\r\n      this.logger.warn('Your HTTP Adapter does not support `.useBodyParser`.');\r\n      return this;\r\n    }\r\n\r\n    const [parserType, ...otherArgs] = args;\r\n    const rawBody = !!this.appOptions.rawBody;\r\n\r\n    this.httpAdapter.useBodyParser(...[parserType, rawBody, ...otherArgs]);\r\n\r\n    return this;\r\n  }\r\n\r\n  public enableCors(options?: CorsOptions | CorsOptionsDelegate<any>): void {\r\n    this.httpAdapter.enableCors(options);\r\n  }\r\n\r\n  public enableVersioning(\r\n    options: VersioningOptions = { type: VersioningType.URI },\r\n  ): this {\r\n    this.config.enableVersioning(options);\r\n    return this;\r\n  }\r\n\r\n  public async listen(port: number | string): Promise<any>;\r\n  public async listen(port: number | string, hostname: string): Promise<any>;\r\n  public async listen(port: number | string, ...args: any[]): Promise<any> {\r\n    this.assertNotInPreviewMode('listen');\r\n    !this.isInitialized && (await this.init());\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const errorHandler = (e: any) => {\r\n        this.logger.error(e?.toString?.());\r\n        reject(e);\r\n      };\r\n      this.httpServer.once('error', errorHandler);\r\n\r\n      const isCallbackInOriginalArgs = isFunction(args[args.length - 1]);\r\n      const listenFnArgs = isCallbackInOriginalArgs\r\n        ? args.slice(0, args.length - 1)\r\n        : args;\r\n\r\n      this.httpAdapter.listen(\r\n        port,\r\n        ...listenFnArgs,\r\n        (...originalCallbackArgs: unknown[]) => {\r\n          if (this.appOptions?.autoFlushLogs ?? true) {\r\n            this.flushLogs();\r\n          }\r\n          if (originalCallbackArgs[0] instanceof Error) {\r\n            return reject(originalCallbackArgs[0]);\r\n          }\r\n\r\n          const address = this.httpServer.address();\r\n          if (address) {\r\n            this.httpServer.removeListener('error', errorHandler);\r\n            this.isListening = true;\r\n            resolve(this.httpServer);\r\n          }\r\n          if (isCallbackInOriginalArgs) {\r\n            args[args.length - 1](...originalCallbackArgs);\r\n          }\r\n        },\r\n      );\r\n    });\r\n  }\r\n\r\n  public async getUrl(): Promise<string> {\r\n    return new Promise((resolve, reject) => {\r\n      if (!this.isListening) {\r\n        this.logger.error(MESSAGES.CALL_LISTEN_FIRST);\r\n        reject(MESSAGES.CALL_LISTEN_FIRST);\r\n        return;\r\n      }\r\n      const address = this.httpServer.address();\r\n      resolve(this.formatAddress(address));\r\n    });\r\n  }\r\n\r\n  private formatAddress(address: any): string {\r\n    if (isString(address)) {\r\n      if (platform() === 'win32') {\r\n        return address;\r\n      }\r\n      const basePath = encodeURIComponent(address);\r\n      return `${this.getProtocol()}+unix://${basePath}`;\r\n    }\r\n\r\n    let host = this.host();\r\n    if (address && address.family === 'IPv6') {\r\n      if (host === '::') {\r\n        host = '[::1]';\r\n      } else {\r\n        host = `[${host}]`;\r\n      }\r\n    } else if (host === '0.0.0.0') {\r\n      host = '127.0.0.1';\r\n    }\r\n\r\n    return `${this.getProtocol()}://${host}:${address.port}`;\r\n  }\r\n\r\n  public setGlobalPrefix(prefix: string, options?: GlobalPrefixOptions): this {\r\n    this.config.setGlobalPrefix(prefix);\r\n    if (options) {\r\n      const exclude = options?.exclude\r\n        ? mapToExcludeRoute(options.exclude)\r\n        : [];\r\n      this.config.setGlobalPrefixOptions({\r\n        ...options,\r\n        exclude,\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public useWebSocketAdapter(adapter: WebSocketAdapter): this {\r\n    this.config.setIoAdapter(adapter);\r\n    return this;\r\n  }\r\n\r\n  public useGlobalFilters(...filters: ExceptionFilter[]): this {\r\n    this.config.useGlobalFilters(...filters);\r\n    filters.forEach(item =>\r\n      this.graphInspector.insertOrphanedEnhancer({\r\n        subtype: 'filter',\r\n        ref: item,\r\n      }),\r\n    );\r\n    return this;\r\n  }\r\n\r\n  public useGlobalPipes(...pipes: PipeTransform<any>[]): this {\r\n    this.config.useGlobalPipes(...pipes);\r\n    pipes.forEach(item =>\r\n      this.graphInspector.insertOrphanedEnhancer({\r\n        subtype: 'pipe',\r\n        ref: item,\r\n      }),\r\n    );\r\n    return this;\r\n  }\r\n\r\n  public useGlobalInterceptors(...interceptors: NestInterceptor[]): this {\r\n    this.config.useGlobalInterceptors(...interceptors);\r\n    interceptors.forEach(item =>\r\n      this.graphInspector.insertOrphanedEnhancer({\r\n        subtype: 'interceptor',\r\n        ref: item,\r\n      }),\r\n    );\r\n    return this;\r\n  }\r\n\r\n  public useGlobalGuards(...guards: CanActivate[]): this {\r\n    this.config.useGlobalGuards(...guards);\r\n    guards.forEach(item =>\r\n      this.graphInspector.insertOrphanedEnhancer({\r\n        subtype: 'guard',\r\n        ref: item,\r\n      }),\r\n    );\r\n    return this;\r\n  }\r\n\r\n  public useStaticAssets(options: any): this;\r\n  public useStaticAssets(path: string, options?: any): this;\r\n  public useStaticAssets(pathOrOptions: any, options?: any): this {\r\n    this.httpAdapter.useStaticAssets &&\r\n      this.httpAdapter.useStaticAssets(pathOrOptions, options);\r\n    return this;\r\n  }\r\n\r\n  public setBaseViewsDir(path: string | string[]): this {\r\n    this.httpAdapter.setBaseViewsDir && this.httpAdapter.setBaseViewsDir(path);\r\n    return this;\r\n  }\r\n\r\n  public setViewEngine(engineOrOptions: any): this {\r\n    this.httpAdapter.setViewEngine &&\r\n      this.httpAdapter.setViewEngine(engineOrOptions);\r\n    return this;\r\n  }\r\n  private host(): string | undefined {\r\n    const address = this.httpServer.address();\r\n    if (isString(address)) {\r\n      return undefined;\r\n    }\r\n    return address && address.address;\r\n  }\r\n\r\n  private getProtocol(): 'http' | 'https' {\r\n    return this.appOptions && this.appOptions.httpsOptions ? 'https' : 'http';\r\n  }\r\n\r\n  private async registerMiddleware(instance: any) {\r\n    await this.middlewareModule.registerMiddleware(\r\n      this.middlewareContainer,\r\n      instance,\r\n    );\r\n  }\r\n}\r\n"]}