{"version":3,"file":"nats-request-json.deserializer.js","sourceRoot":"","sources":["nats-request-json.deserializer.ts"],"names":[],"mappings":";;;AAAA,8EAAqE;AAGrE,mFAA8E;AAE9E,IAAI,WAAW,GAAG,EAAS,CAAC;AAE5B;;GAEG;AACH,MAAa,2BAA4B,SAAQ,2DAA2B;IAG1E;QACE,KAAK,EAAE,CAAC;QAER,WAAW,GAAG,IAAA,+BAAW,EAAC,MAAM,EAAE,2BAA2B,CAAC,IAAI,EAAE,GAAG,EAAE,CACvE,OAAO,CAAC,MAAM,CAAC,CAChB,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,WAAW,CAAC,SAAS,EAAE,CAAC;IAC3C,CAAC;IAED,WAAW,CACT,KAAiB,EACjB,OAA6B;QAE7B,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACpD,OAAO,KAAK,CAAC,WAAW,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;IACpD,CAAC;CACF;AAnBD,kEAmBC","sourcesContent":["import { loadPackage } from '@nestjs/common/utils/load-package.util';\r\nimport { NatsCodec } from '../external/nats-client.interface';\r\nimport { IncomingEvent, IncomingRequest } from '../interfaces';\r\nimport { IncomingRequestDeserializer } from './incoming-request.deserializer';\r\n\r\nlet natsPackage = {} as any;\r\n\r\n/**\r\n * @publicApi\r\n */\r\nexport class NatsRequestJSONDeserializer extends IncomingRequestDeserializer {\r\n  private readonly jsonCodec: NatsCodec<unknown>;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    natsPackage = loadPackage('nats', NatsRequestJSONDeserializer.name, () =>\r\n      require('nats'),\r\n    );\r\n    this.jsonCodec = natsPackage.JSONCodec();\r\n  }\r\n\r\n  deserialize(\r\n    value: Uint8Array,\r\n    options?: Record<string, any>,\r\n  ): IncomingRequest | IncomingEvent {\r\n    const decodedRequest = this.jsonCodec.decode(value);\r\n    return super.deserialize(decodedRequest, options);\r\n  }\r\n}\r\n"]}