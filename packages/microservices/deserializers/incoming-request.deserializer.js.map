{"version":3,"file":"incoming-request.deserializer.js","sourceRoot":"","sources":["incoming-request.deserializer.ts"],"names":[],"mappings":";;;AAAA,oEAAgE;AAOhE;;GAEG;AACH,MAAa,2BAA2B;IACtC,WAAW,CACT,KAAU,EACV,OAA6B;QAE7B,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;IAC3E,CAAC;IAED,UAAU,CAAC,KAAU;QACnB,IAAI,CAAC,KAAK,EAAE;YACV,OAAO,IAAI,CAAC;SACb;QACD,IACE,CAAC,IAAA,0BAAW,EAAE,KAAyB,CAAC,OAAO,CAAC;YAChD,CAAC,IAAA,0BAAW,EAAE,KAAyB,CAAC,IAAI,CAAC,EAC7C;YACA,OAAO,KAAK,CAAC;SACd;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,WAAW,CACT,KAAU,EACV,OAA6B;QAE7B,IAAI,CAAC,OAAO,EAAE;YACZ,OAAO;gBACL,OAAO,EAAE,SAAS;gBAClB,IAAI,EAAE,SAAS;aAChB,CAAC;SACH;QACD,OAAO;YACL,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,IAAI,EAAE,KAAK;SACZ,CAAC;IACJ,CAAC;CACF;AApCD,kEAoCC","sourcesContent":["import { isUndefined } from '@nestjs/common/utils/shared.utils';\r\nimport {\r\n  ConsumerDeserializer,\r\n  IncomingEvent,\r\n  IncomingRequest,\r\n} from '../interfaces';\r\n\r\n/**\r\n * @publicApi\r\n */\r\nexport class IncomingRequestDeserializer implements ConsumerDeserializer {\r\n  deserialize(\r\n    value: any,\r\n    options?: Record<string, any>,\r\n  ): IncomingRequest | IncomingEvent {\r\n    return this.isExternal(value) ? this.mapToSchema(value, options) : value;\r\n  }\r\n\r\n  isExternal(value: any): boolean {\r\n    if (!value) {\r\n      return true;\r\n    }\r\n    if (\r\n      !isUndefined((value as IncomingRequest).pattern) ||\r\n      !isUndefined((value as IncomingRequest).data)\r\n    ) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  mapToSchema(\r\n    value: any,\r\n    options?: Record<string, any>,\r\n  ): IncomingRequest | IncomingEvent {\r\n    if (!options) {\r\n      return {\r\n        pattern: undefined,\r\n        data: undefined,\r\n      };\r\n    }\r\n    return {\r\n      pattern: options.channel,\r\n      data: value,\r\n    };\r\n  }\r\n}\r\n"]}