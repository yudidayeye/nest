{"version":3,"file":"validation.pipe.js","sourceRoot":"","sources":["validation.pipe.ts"],"names":[],"mappings":"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","sourcesContent":["import { iterate } from 'iterare';\r\nimport { types } from 'util';\r\nimport { Optional } from '../decorators';\r\nimport { Injectable } from '../decorators/core';\r\nimport { HttpStatus } from '../enums/http-status.enum';\r\nimport { ClassTransformOptions } from '../interfaces/external/class-transform-options.interface';\r\nimport { TransformerPackage } from '../interfaces/external/transformer-package.interface';\r\nimport { ValidationError } from '../interfaces/external/validation-error.interface';\r\nimport { ValidatorOptions } from '../interfaces/external/validator-options.interface';\r\nimport { ValidatorPackage } from '../interfaces/external/validator-package.interface';\r\nimport {\r\n  ArgumentMetadata,\r\n  PipeTransform,\r\n} from '../interfaces/features/pipe-transform.interface';\r\nimport { Type } from '../interfaces/type.interface';\r\nimport {\r\n  ErrorHttpStatusCode,\r\n  HttpErrorByCode,\r\n} from '../utils/http-error-by-code.util';\r\nimport { loadPackage } from '../utils/load-package.util';\r\nimport { isNil, isUndefined } from '../utils/shared.utils';\r\n\r\n/**\r\n * @publicApi\r\n */\r\nexport interface ValidationPipeOptions extends ValidatorOptions {\r\n  transform?: boolean;\r\n  disableErrorMessages?: boolean;\r\n  transformOptions?: ClassTransformOptions;\r\n  errorHttpStatusCode?: ErrorHttpStatusCode;\r\n  exceptionFactory?: (errors: ValidationError[]) => any;\r\n  validateCustomDecorators?: boolean;\r\n  expectedType?: Type<any>;\r\n  validatorPackage?: ValidatorPackage;\r\n  transformerPackage?: TransformerPackage;\r\n}\r\n\r\nlet classValidator: ValidatorPackage = {} as any;\r\nlet classTransformer: TransformerPackage = {} as any;\r\n\r\n/**\r\n * @see [Validation](https://docs.nestjs.com/techniques/validation)\r\n *\r\n * @publicApi\r\n */\r\n@Injectable()\r\nexport class ValidationPipe implements PipeTransform<any> {\r\n  protected isTransformEnabled: boolean;\r\n  protected isDetailedOutputDisabled?: boolean;\r\n  protected validatorOptions: ValidatorOptions;\r\n  protected transformOptions: ClassTransformOptions;\r\n  protected errorHttpStatusCode: ErrorHttpStatusCode;\r\n  protected expectedType: Type<any>;\r\n  protected exceptionFactory: (errors: ValidationError[]) => any;\r\n  protected validateCustomDecorators: boolean;\r\n\r\n  constructor(@Optional() options?: ValidationPipeOptions) {\r\n    options = options || {};\r\n    const {\r\n      transform,\r\n      disableErrorMessages,\r\n      errorHttpStatusCode,\r\n      expectedType,\r\n      transformOptions,\r\n      validateCustomDecorators,\r\n      ...validatorOptions\r\n    } = options;\r\n\r\n    // @see https://github.com/nestjs/nest/issues/10683#issuecomment-1413690508\r\n    this.validatorOptions = { forbidUnknownValues: false, ...validatorOptions };\r\n\r\n    this.isTransformEnabled = !!transform;\r\n    this.transformOptions = transformOptions;\r\n    this.isDetailedOutputDisabled = disableErrorMessages;\r\n    this.validateCustomDecorators = validateCustomDecorators || false;\r\n    this.errorHttpStatusCode = errorHttpStatusCode || HttpStatus.BAD_REQUEST;\r\n    this.expectedType = expectedType;\r\n    this.exceptionFactory =\r\n      options.exceptionFactory || this.createExceptionFactory();\r\n\r\n    classValidator = this.loadValidator(options.validatorPackage);\r\n    classTransformer = this.loadTransformer(options.transformerPackage);\r\n  }\r\n\r\n  protected loadValidator(\r\n    validatorPackage?: ValidatorPackage,\r\n  ): ValidatorPackage {\r\n    return (\r\n      validatorPackage ??\r\n      loadPackage('class-validator', 'ValidationPipe', () =>\r\n        require('class-validator'),\r\n      )\r\n    );\r\n  }\r\n\r\n  protected loadTransformer(\r\n    transformerPackage?: TransformerPackage,\r\n  ): TransformerPackage {\r\n    return (\r\n      transformerPackage ??\r\n      loadPackage('class-transformer', 'ValidationPipe', () =>\r\n        require('class-transformer'),\r\n      )\r\n    );\r\n  }\r\n\r\n  public async transform(value: any, metadata: ArgumentMetadata) {\r\n    if (this.expectedType) {\r\n      metadata = { ...metadata, metatype: this.expectedType };\r\n    }\r\n\r\n    const metatype = metadata.metatype;\r\n    if (!metatype || !this.toValidate(metadata)) {\r\n      return this.isTransformEnabled\r\n        ? this.transformPrimitive(value, metadata)\r\n        : value;\r\n    }\r\n    const originalValue = value;\r\n    value = this.toEmptyIfNil(value);\r\n\r\n    const isNil = value !== originalValue;\r\n    const isPrimitive = this.isPrimitive(value);\r\n    this.stripProtoKeys(value);\r\n    let entity = classTransformer.plainToClass(\r\n      metatype,\r\n      value,\r\n      this.transformOptions,\r\n    );\r\n\r\n    const originalEntity = entity;\r\n    const isCtorNotEqual = entity.constructor !== metatype;\r\n\r\n    if (isCtorNotEqual && !isPrimitive) {\r\n      entity.constructor = metatype;\r\n    } else if (isCtorNotEqual) {\r\n      // when \"entity\" is a primitive value, we have to temporarily\r\n      // replace the entity to perform the validation against the original\r\n      // metatype defined inside the handler\r\n      entity = { constructor: metatype };\r\n    }\r\n\r\n    const errors = await this.validate(entity, this.validatorOptions);\r\n    if (errors.length > 0) {\r\n      throw await this.exceptionFactory(errors);\r\n    }\r\n    if (isPrimitive) {\r\n      // if the value is a primitive value and the validation process has been successfully completed\r\n      // we have to revert the original value passed through the pipe\r\n      entity = originalEntity;\r\n    }\r\n    if (this.isTransformEnabled) {\r\n      return entity;\r\n    }\r\n    if (isNil) {\r\n      // if the value was originally undefined or null, revert it back\r\n      return originalValue;\r\n    }\r\n    // we check if the number of keys of the \"validatorOptions\" is higher than 1 (instead of 0)\r\n    // because the \"forbidUnknownValues\" now fallbacks to \"false\" (in case it wasn't explicitly specified)\r\n    const shouldTransformToPlain =\r\n      Object.keys(this.validatorOptions).length > 1;\r\n    return shouldTransformToPlain\r\n      ? classTransformer.classToPlain(entity, this.transformOptions)\r\n      : value;\r\n  }\r\n\r\n  public createExceptionFactory() {\r\n    return (validationErrors: ValidationError[] = []) => {\r\n      if (this.isDetailedOutputDisabled) {\r\n        return new HttpErrorByCode[this.errorHttpStatusCode]();\r\n      }\r\n      const errors = this.flattenValidationErrors(validationErrors);\r\n      return new HttpErrorByCode[this.errorHttpStatusCode](errors);\r\n    };\r\n  }\r\n\r\n  protected toValidate(metadata: ArgumentMetadata): boolean {\r\n    const { metatype, type } = metadata;\r\n    if (type === 'custom' && !this.validateCustomDecorators) {\r\n      return false;\r\n    }\r\n    const types = [String, Boolean, Number, Array, Object, Buffer];\r\n    return !types.some(t => metatype === t) && !isNil(metatype);\r\n  }\r\n\r\n  protected transformPrimitive(value: any, metadata: ArgumentMetadata) {\r\n    if (!metadata.data) {\r\n      // leave top-level query/param objects unmodified\r\n      return value;\r\n    }\r\n    const { type, metatype } = metadata;\r\n    if (type !== 'param' && type !== 'query') {\r\n      return value;\r\n    }\r\n    if (metatype === Boolean) {\r\n      if (isUndefined(value)) {\r\n        // This is an workaround to deal with optional boolean values since\r\n        // optional booleans shouldn't be parsed to a valid boolean when\r\n        // they were not defined\r\n        return undefined;\r\n      }\r\n      // Any fasly value but `undefined` will be parsed to `false`\r\n      return value === true || value === 'true';\r\n    }\r\n    if (metatype === Number) {\r\n      return +value;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  protected toEmptyIfNil<T = any, R = any>(value: T): R | {} {\r\n    return isNil(value) ? {} : value;\r\n  }\r\n\r\n  protected stripProtoKeys(value: any) {\r\n    if (\r\n      value == null ||\r\n      typeof value !== 'object' ||\r\n      types.isTypedArray(value)\r\n    ) {\r\n      return;\r\n    }\r\n    if (Array.isArray(value)) {\r\n      for (const v of value) {\r\n        this.stripProtoKeys(v);\r\n      }\r\n      return;\r\n    }\r\n    delete value.__proto__;\r\n    for (const key in value) {\r\n      this.stripProtoKeys(value[key]);\r\n    }\r\n  }\r\n\r\n  protected isPrimitive(value: unknown): boolean {\r\n    return ['number', 'boolean', 'string'].includes(typeof value);\r\n  }\r\n\r\n  protected validate(\r\n    object: object,\r\n    validatorOptions?: ValidatorOptions,\r\n  ): Promise<ValidationError[]> | ValidationError[] {\r\n    return classValidator.validate(object, validatorOptions);\r\n  }\r\n\r\n  protected flattenValidationErrors(\r\n    validationErrors: ValidationError[],\r\n  ): string[] {\r\n    return iterate(validationErrors)\r\n      .map(error => this.mapChildrenToValidationErrors(error))\r\n      .flatten()\r\n      .filter(item => !!item.constraints)\r\n      .map(item => Object.values(item.constraints))\r\n      .flatten()\r\n      .toArray();\r\n  }\r\n\r\n  protected mapChildrenToValidationErrors(\r\n    error: ValidationError,\r\n    parentPath?: string,\r\n  ): ValidationError[] {\r\n    if (!(error.children && error.children.length)) {\r\n      return [error];\r\n    }\r\n    const validationErrors = [];\r\n    parentPath = parentPath\r\n      ? `${parentPath}.${error.property}`\r\n      : error.property;\r\n    for (const item of error.children) {\r\n      if (item.children && item.children.length) {\r\n        validationErrors.push(\r\n          ...this.mapChildrenToValidationErrors(item, parentPath),\r\n        );\r\n      }\r\n      validationErrors.push(\r\n        this.prependConstraintsWithParentProp(parentPath, item),\r\n      );\r\n    }\r\n    return validationErrors;\r\n  }\r\n\r\n  protected prependConstraintsWithParentProp(\r\n    parentPath: string,\r\n    error: ValidationError,\r\n  ): ValidationError {\r\n    const constraints = {};\r\n    for (const key in error.constraints) {\r\n      constraints[key] = `${parentPath}.${error.constraints[key]}`;\r\n    }\r\n    return {\r\n      ...error,\r\n      constraints,\r\n    };\r\n  }\r\n}\r\n"]}